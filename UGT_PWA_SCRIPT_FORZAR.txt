/**
 * ðŸŽ¯ SCRIPT PARA FORZAR POPUP PWA - UGT TOWA
 * 
 * INSTRUCCIONES:
 * 1. Abre tu sitio web: https://9ya0vtpov5ir.space.minimax.io
 * 2. Presiona F12 para abrir la consola del navegador
 * 3. Copia y pega TODO este cÃ³digo en la consola
 * 4. Presiona Enter
 * 
 * El popup aparecerÃ¡ inmediatamente
 */

// ðŸ§¹ LIMPIAR ESTADO ANTERIOR
localStorage.removeItem('pwa-install-dismissed');
localStorage.removeItem('pwa-install-dismissed-time');

// ðŸŽ¯ MÃ‰TODO 1: Forzar usando el evento personalizado
function forzarPopupInmediato() {
    console.log('ðŸŽ¯ Forzando popup PWA...');
    
    // Buscar y activar el componente PWA
    setTimeout(() => {
        // Intentar encontrar el popup por clase
        const popups = document.querySelectorAll('[class*="animate-slide-up"], [class*="fixed"], [class*="z-50"]');
        
        popups.forEach(element => {
            if (element.innerHTML.includes('UGT') || element.innerHTML.includes('Instalar')) {
                console.log('âœ… Popup encontrado:', element);
                element.style.display = 'block';
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
                element.style.zIndex = '9999';
                
                // Scroll hasta el popup si estÃ¡ fuera de vista
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });
        
        // Si no se encuentra, forzar reapariciÃ³n despuÃ©s de recarga
        if (popups.length === 0) {
            console.log('ðŸ”„ Popup no encontrado, recargando pÃ¡gina...');
            location.reload();
        }
        
    }, 1000);
}

// ðŸŽ¯ MÃ‰TODO 2: Forzar con evento personalizado (si el componente lo soporta)
function forzarConEvento() {
    const evento = new CustomEvent('force-pwa-prompt');
    window.dispatchEvent(evento);
    console.log('ðŸ“¢ Evento personalizado enviado');
}

// ðŸŽ¯ MÃ‰TODO 3: Simular comportamiento PWA
function simularPWAAvailable() {
    console.log('ðŸŽ­ Simulando PWA disponible...');
    
    // Crear evento simulado
    const eventoSimulado = new Event('beforeinstallprompt');
    window.dispatchEvent(eventoSimulado);
    
    // Actualizar estado localStorage
    localStorage.setItem('pwa-prompt-available', 'true');
    localStorage.setItem('pwa-prompt-timestamp', Date.now().toString());
    
    forzarPopupInmediato();
}

// ðŸš€ EJECUTAR MÃ‰TODOS
console.log('ðŸš€ Iniciando forzado de popup PWA...');

// MÃ©todo principal
forzarPopupInmediato();

// MÃ©todos alternativos
setTimeout(() => forzarConEvento(), 2000);
setTimeout(() => simularPWAAvailable(), 3000);

// ðŸ“± INFORMACIÃ“N DE DEBUG
console.log('ðŸ“Š Estado actual:', {
    localStorage: {
        dismissed: localStorage.getItem('pwa-install-dismissed'),
        timestamp: localStorage.getItem('pwa-install-dismissed-time')
    },
    browser: {
        standalone: window.matchMedia('(display-mode: standalone)').matches,
        serviceWorker: 'serviceWorker' in navigator,
        installPrompt: 'beforeinstallprompt' in window
    }
});

// ðŸ”„ FUNCIÃ“N DE RESET COMPLETO
window.resetearPWACompleto = function() {
    console.log('ðŸ”„ Reseteo completo de PWA...');
    
    localStorage.removeItem('pwa-install-dismissed');
    localStorage.removeItem('pwa-install-dismissed-time');
    localStorage.removeItem('pwa-prompt-available');
    localStorage.removeItem('pwa-prompt-timestamp');
    localStorage.removeItem('pwa-installed');
    
    // Si existe service worker, desregistrarlo temporalmente
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
            registrations.forEach(registration => {
                registration.unregister();
                console.log('ðŸ§¹ Service Worker desregistrado');
            });
        });
    }
    
    // Recargar pÃ¡gina
    setTimeout(() => {
        console.log('ðŸ”„ Recargando pÃ¡gina...');
        location.reload();
    }, 500);
};

// ðŸ“‹ COMANDOS ADICIONALES DISPONIBLES:
// - resetearPWACompleto() â†’ Reset completo y recarga
// - forzarPopupInmediato() â†’ Forzar popup sin recarga
// - simularPWAAvailable() â†’ Simular PWA disponible

console.log(`
ðŸŽ¯ UGT Towa PWA Popup Forcer
Comandos listos:
âœ… resetearPWACompleto()    â†’ Reset completo
âœ… forzarPopupInmediato()   â†’ Forzar popup
âœ… simularPWAAvailable()    â†’ Simular PWA disponible

ðŸŽ® Presiona Enter si no apareciÃ³ el popup
`);
